version: '3.9'

services:
  makizapp_db:
    container_name: java_db
    restart: always
    image: postgres:16
    ports:
      - "5432:5432"
    environment:
      POSTGRES_PASSWORD: password
      POSTGRES_USER: admin
      POSTGRES_DB: makizapp
    volumes:
      - pgdata:/var/lib/postgresql/data

  makizapp_backend:
    container_name: makizapp
    restart: unless-stopped
    image: makizapp:latest
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
      - /usr/bin/docker:/usr/bin/docker
    stdin_open: true
    tty: true
    environment:
      JWT_SECRET: "d095d37725430bff93b35467a9cbd13091e8c0729988a035e4d029abffd470318f2f338677aadcaae2d8fd83f4253e9476138c0043f66dcb0f006e5b33e19b6cf9fb4e3b7e6e4a88f8242ce65960dd518a1290183f7982cf5d6c5c760ce96b43f078ccf6c2d4c25772655576e326f0cb039adfcd7afc59fa925895f77b6677ef7050c66146ffd8852e950ef662af51241c5c6a5ddd2e37a03a5026969a30b724fb7c3654b1c299a3a60b9a63d2e55a5dda16657e97b38217dc897fbd1cc70ec3ff12b92b3c7803cdec95f2e9d794a5e1835aac9d1f34407619b767aa47cdd572973baa4ded101f42a69a40aa3366b5beba62219aa913416ae64562d93490d737"
#      DB_URL: "jdbc:postgresql://34.58.98.24:5432/makizapp"
    depends_on:
      - mind-tracker-compiler
    ports:
      - 8080:8080

  mind-tracker-compiler:
    image: mind-tracker-compiler
    build:
      context: ./image-tracking-project
    container_name: mind-tracker-compiler
    command: /bin/true

volumes:
  pgdata: {}
